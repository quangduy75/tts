<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VÄƒn báº£n sang giá»ng Ä‘á»c</title>
    <!-- ResponsiveVoice API -->
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=EQD1l7rq"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">VÄƒn báº£ng sang giá»ng Ä‘á»c</h1>
        <div class="mb-3">
            <label for="textInput" class="form-label">Nháº­p vÄƒn báº£n Ä‘á»ƒ Ä‘á»c:</label>
            <textarea id="textInput" class="form-control" rows="5" placeholder="Nháº­p ná»™i dung táº¡i Ä‘Ã¢y..."></textarea>
        </div>
        <div class="mb-3">
            <label for="voiceSelect" class="form-label">Chá»n giá»ng Ä‘á»c:</label>
            <select id="voiceSelect" class="form-select">
                <option value="Vietnamese Female">Ná»¯</option>
                <option value="Vietnamese Male">Nam</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="speedRange" class="form-label">Äiá»u chá»‰nh tá»‘c Ä‘á»™ Ä‘á»c (0.5 cháº­m - 2.0 nhanh):</label>
            <input type="range" id="speedRange" class="form-range" min="0.5" max="2.0" step="0.1" value="1">
            <div id="speedValue" class="text-muted">Tá»‘c Ä‘á»™ hiá»‡n táº¡i: 1.0</div>
        </div>
        <div class="text-center">
            <button class="btn btn-primary me-2" onclick="readText()">ğŸ”Š Äá»c vÄƒn báº£n</button>
            <button class="btn btn-success me-2" onclick="startRecording()">ğŸ™ï¸ Báº¯t Ä‘áº§u ghi Ã¢m</button>
            <button class="btn btn-danger" onclick="stopRecording()">â¹ï¸ Dá»«ng ghi Ã¢m</button>
        </div>
        <div class="mt-3">
            <p><strong>Táº£i xuá»‘ng Ã¢m thanh Ä‘Ã£ ghi:</strong></p>
            <a id="downloadLink" class="btn btn-secondary" style="display: none;">Táº£i Ã¢m thanh</a>
        </div>
    </div>

    <script>
        let mediaRecorder;
        let audioChunks = [];
        let audioBlob;

        // Cáº­p nháº­t hiá»ƒn thá»‹ giÃ¡ trá»‹ tá»‘c Ä‘á»™ khi thay Ä‘á»•i thanh kÃ©o
        document.getElementById("speedRange").addEventListener("input", function () {
            const speed = this.value;
            document.getElementById("speedValue").innerText = `Tá»‘c Ä‘á»™ hiá»‡n táº¡i: ${speed}`;
        });

        // Äá»c vÄƒn báº£n vá»›i giá»ng Ä‘á»c vÃ  tá»‘c Ä‘á»™ Ä‘Æ°á»£c chá»n
        function readText() {
            const text = document.getElementById("textInput").value;
            const voice = document.getElementById("voiceSelect").value;
            const speed = document.getElementById("speedRange").value;

            if (!text.trim()) {
                alert("Vui lÃ²ng nháº­p vÄƒn báº£n Ä‘á»ƒ Ä‘á»c.");
                return;
            }

            responsiveVoice.speak(text, voice, { rate: parseFloat(speed) });
        }

        // Báº¯t Ä‘áº§u ghi Ã¢m
        function startRecording() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const dest = audioContext.createMediaStreamDestination();
            const utterance = new SpeechSynthesisUtterance(document.getElementById("textInput").value);
            utterance.lang = "vi-VN";

            const audioSource = audioContext.createMediaStreamSource(dest.stream);
            mediaRecorder = new MediaRecorder(audioSource.stream);

            mediaRecorder.ondataavailable = (e) => {
                audioChunks.push(e.data);
            };

            mediaRecorder.onstop = () => {
                audioBlob = new Blob(audioChunks, { type: "audio/webm" });
                audioChunks = [];
                showDownloadLink(audioBlob);
            };

            speechSynthesis.speak(utterance);
            audioSource.connect(dest);
            mediaRecorder.start();
        }

        // Dá»«ng ghi Ã¢m
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
            } else {
                alert("Ghi Ã¢m chÆ°a Ä‘Æ°á»£c báº¯t Ä‘áº§u!");
            }
        }

        // Hiá»ƒn thá»‹ liÃªn káº¿t táº£i xuá»‘ng Ã¢m thanh
        function showDownloadLink(blob) {
            const url = URL.createObjectURL(blob);
            const downloadLink = document.getElementById("downloadLink");
            downloadLink.href = url;
            downloadLink.download = "recorded-audio.webm";
            downloadLink.style.display = "inline-block";
        }
    </script>
</body>
</html>
